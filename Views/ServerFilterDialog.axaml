<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="using:ZScape.Controls"
        xmlns:local="using:ZScape.Views"
        x:Class="ZScape.Views.ServerFilterDialog"
        Title="Advanced Server Filter"
        Width="550" Height="520"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        ExtendClientAreaToDecorationsHint="False">
    
    <Window.Resources>
        <local:AlternatingRowConverter x:Key="AlternatingRowConverter"/>
    </Window.Resources>
    
    <Grid Margin="10" RowDefinitions="40,*,45">
        <!-- Preset panel -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="10">
            <TextBlock Text="Preset:" VerticalAlignment="Center"/>
            <ComboBox x:Name="PresetComboBox" Width="200"/>
            <Button x:Name="SavePresetButton" Content="Save" Width="60" Height="25"
                    Click="SavePresetButton_Click"/>
            <Button x:Name="DeletePresetButton" Content="Delete" Width="60" Height="25"
                    Click="DeletePresetButton_Click" IsEnabled="False"/>
        </StackPanel>
        
        <!-- Tab control -->
        <TabControl Grid.Row="1" x:Name="FilterTabControl">
            <TabControl.Styles>
                <Style Selector="TabItem">
                    <Setter Property="FontSize" Value="12"/>
                    <Setter Property="Padding" Value="8,4"/>
                </Style>
            </TabControl.Styles>
            <!-- Basic tab -->
            <TabItem Header="Basic">
                <StackPanel Margin="15" Spacing="10">
                    <CheckBox x:Name="ShowEmptyCheckBox" Content="Show empty servers"/>
                    <CheckBox x:Name="HideBotOnlyCheckBox" Content="Hide bot-only servers (treat as empty)"/>
                    <CheckBox x:Name="ShowFullCheckBox" Content="Show full servers"/>
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="Passworded servers:" VerticalAlignment="Center"/>
                        <ComboBox x:Name="PasswordedComboBox" Width="150">
                            <ComboBoxItem Content="Show all"/>
                            <ComboBoxItem Content="Show only"/>
                            <ComboBoxItem Content="Hide"/>
                        </ComboBox>
                    </StackPanel>
                    <CheckBox x:Name="ShowUnresponsiveCheckBox" Content="Show unresponsive servers"/>
                    <Separator Margin="0,10"/>
                    <TextBlock Text="Sorting" FontWeight="Bold"/>
                    <CheckBox x:Name="PopulatedFirstCheckBox" Content="Show populated servers first"/>
                </StackPanel>
            </TabItem>
            
            <!-- Text Filters tab -->
            <TabItem Header="Text">
                <StackPanel Margin="15" Spacing="15">
                    <StackPanel Spacing="3">
                        <TextBlock Text="Server name contains:"/>
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBox Grid.Column="0" x:Name="ServerNameTextBox"/>
                            <CheckBox Grid.Column="1" x:Name="ServerNameRegexCheckBox" Content="Regex" Margin="10,0,0,0"/>
                        </Grid>
                    </StackPanel>
                    <StackPanel Spacing="3">
                        <TextBlock Text="Map name contains:"/>
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBox Grid.Column="0" x:Name="MapTextBox"/>
                            <CheckBox Grid.Column="1" x:Name="MapRegexCheckBox" Content="Regex" Margin="10,0,0,0"/>
                        </Grid>
                    </StackPanel>
                    <StackPanel Spacing="3">
                        <TextBlock Text="Version contains:"/>
                        <TextBox x:Name="VersionTextBox" Width="200" HorizontalAlignment="Left"/>
                    </StackPanel>
                    <TextBlock Text="Tip: Use * for any characters, ? for single character.&#10;Enable Regex for advanced pattern matching."
                               Foreground="Gray" FontSize="11"/>
                </StackPanel>
            </TabItem>
            
            <!-- Game Modes tab -->
            <TabItem Header="Modes">
                <Grid Margin="10" RowDefinitions="Auto,Auto,*,Auto" ColumnDefinitions="*,*">
                    <TextBlock Grid.Row="0" Text="Include Modes:"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="Exclude Modes:"/>
                    
                    <TextBox Grid.Row="1" x:Name="IncludeModeSearchBox" Watermark="Search modes..." Margin="0,5,5,5"/>
                    <TextBox Grid.Row="1" Grid.Column="1" x:Name="ExcludeModeSearchBox" Watermark="Search modes..." Margin="5,5,0,5"/>
                    
                    <ScrollViewer Grid.Row="2" Margin="0,0,5,0">
                        <ItemsControl x:Name="IncludeModesItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding Index, Converter={StaticResource AlternatingRowConverter}}"
                                            Padding="4,1" Cursor="Hand"
                                            PointerPressed="IncludeModeRow_PointerPressed"
                                            PointerEntered="FilterRow_PointerEntered"
                                            PointerExited="FilterRow_PointerExited">
                                        <CheckBox Content="{Binding Name}" IsChecked="{Binding IsIncluded}" 
                                                  IsHitTestVisible="False"/>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    <ScrollViewer Grid.Row="2" Grid.Column="1" Margin="5,0,0,0">
                        <ItemsControl x:Name="ExcludeModesItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding Index, Converter={StaticResource AlternatingRowConverter}}"
                                            Padding="4,1" Cursor="Hand"
                                            PointerPressed="ExcludeModeRow_PointerPressed"
                                            PointerEntered="FilterRow_PointerEntered"
                                            PointerExited="FilterRow_PointerExited">
                                        <CheckBox Content="{Binding Name}" IsChecked="{Binding IsExcluded}" 
                                                  IsHitTestVisible="False"/>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <TextBlock Grid.Row="3" Grid.ColumnSpan="2" 
                               Text="Include = only show these. Exclude = hide these. (Mutually exclusive)"
                               Foreground="Gray" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                </Grid>
            </TabItem>
            
            <!-- WADs tab -->
            <TabItem Header="WADs">
                <Grid Margin="15" RowDefinitions="Auto,*,Auto,*,Auto,*" ColumnDefinitions="*,*">
                    <TextBlock Grid.Row="0" Text="Require ALL of these WADs/IWADs:"/>
                    <TextBox Grid.Row="1" x:Name="RequireWadsTextBox" AcceptsReturn="True" Margin="0,3,10,10"/>
                    
                    <TextBlock Grid.Row="2" Text="Require ANY of these WADs/IWADs:"/>
                    <TextBox Grid.Row="3" x:Name="IncludeAnyWadsTextBox" AcceptsReturn="True" Margin="0,3,10,10"/>
                    
                    <TextBlock Grid.Row="4" Text="Exclude servers with these WADs/IWADs:"/>
                    <TextBox Grid.Row="5" x:Name="ExcludeWadsTextBox" AcceptsReturn="True" Margin="0,3,10,0"/>
                    
                    <TextBlock Grid.Row="0" Grid.Column="1" Grid.RowSpan="6"
                               Text="Enter partial names to match.&#10;Matches both IWADs and PWADs.&#10;&#10;E.g., 'brutal' matches 'brutalv21.pk3'&#10;E.g., 'doom2' matches 'doom2.wad'"
                               Foreground="Gray" Margin="10,0,0,0" TextWrapping="Wrap"/>
                </Grid>
            </TabItem>
            
            <!-- Players/Ping tab -->
            <TabItem Header="Players">
                <StackPanel Margin="15" Spacing="12">
                    <Grid ColumnDefinitions="160,80,*">
                        <TextBlock Text="Minimum players:" VerticalAlignment="Center"/>
                        <controls:NumericSpinner Grid.Column="1" x:Name="MinPlayersNumeric" Minimum="0" Maximum="64" Width="70"/>
                    </Grid>
                    <Grid ColumnDefinitions="160,80,*">
                        <TextBlock Text="Maximum players:" VerticalAlignment="Center"/>
                        <controls:NumericSpinner Grid.Column="1" x:Name="MaxPlayersNumeric" Minimum="0" Maximum="64" Width="70"/>
                        <TextBlock Grid.Column="2" Text="(0 = no limit)" Foreground="Gray" VerticalAlignment="Center" Margin="10,0,0,0"/>
                    </Grid>
                    <Grid ColumnDefinitions="160,80,*">
                        <TextBlock Text="Minimum humans:" VerticalAlignment="Center"/>
                        <controls:NumericSpinner Grid.Column="1" x:Name="MinHumansNumeric" Minimum="0" Maximum="64" Width="70"/>
                        <TextBlock Grid.Column="2" Text="(excludes bots)" Foreground="Gray" VerticalAlignment="Center" Margin="10,0,0,0"/>
                    </Grid>
                    <Separator Margin="0,10"/>
                    <Grid ColumnDefinitions="160,80,*">
                        <TextBlock Text="Minimum ping (ms):" VerticalAlignment="Center"/>
                        <controls:NumericSpinner Grid.Column="1" x:Name="MinPingNumeric" Minimum="0" Maximum="9999" Width="70"/>
                        <TextBlock Grid.Column="2" Text="(0 = no limit)" Foreground="Gray" VerticalAlignment="Center" Margin="10,0,0,0"/>
                    </Grid>
                    <Grid ColumnDefinitions="160,80,*">
                        <TextBlock Text="Maximum ping (ms):" VerticalAlignment="Center"/>
                        <controls:NumericSpinner Grid.Column="1" x:Name="MaxPingNumeric" Minimum="0" Maximum="9999" Width="70"/>
                        <TextBlock Grid.Column="2" Text="(0 = no limit)" Foreground="Gray" VerticalAlignment="Center" Margin="10,0,0,0"/>
                    </Grid>
                </StackPanel>
            </TabItem>
            
            <!-- Country tab -->
            <TabItem Header="Country">
                <Grid Margin="10" RowDefinitions="Auto,Auto,*,Auto" ColumnDefinitions="*,*">
                    <TextBlock Grid.Row="0" Text="Include Countries:"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="Exclude Countries:"/>
                    
                    <TextBox Grid.Row="1" x:Name="IncludeCountrySearchBox" Watermark="Search countries..." Margin="0,5,5,5"/>
                    <TextBox Grid.Row="1" Grid.Column="1" x:Name="ExcludeCountrySearchBox" Watermark="Search countries..." Margin="5,5,0,5"/>
                    
                    <ScrollViewer Grid.Row="2" Margin="0,0,5,0">
                        <ItemsControl x:Name="IncludeCountriesItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding Index, Converter={StaticResource AlternatingRowConverter}}"
                                            Padding="4,1" Cursor="Hand"
                                            PointerPressed="IncludeCountryRow_PointerPressed"
                                            PointerEntered="FilterRow_PointerEntered"
                                            PointerExited="FilterRow_PointerExited">
                                        <CheckBox Content="{Binding Name}" IsChecked="{Binding IsIncluded}" 
                                                  IsHitTestVisible="False"/>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    <ScrollViewer Grid.Row="2" Grid.Column="1" Margin="5,0,0,0">
                        <ItemsControl x:Name="ExcludeCountriesItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding Index, Converter={StaticResource AlternatingRowConverter}}"
                                            Padding="4,1" Cursor="Hand"
                                            PointerPressed="ExcludeCountryRow_PointerPressed"
                                            PointerEntered="FilterRow_PointerEntered"
                                            PointerExited="FilterRow_PointerExited">
                                        <CheckBox Content="{Binding Name}" IsChecked="{Binding IsExcluded}" 
                                                  IsHitTestVisible="False"/>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <TextBlock Grid.Row="3" Grid.ColumnSpan="2" 
                               Text="Include = only show these. Exclude = hide these. (Mutually exclusive)"
                               Foreground="Gray" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                </Grid>
            </TabItem>
        </TabControl>
        
        <!-- Button panel -->
        <Grid Grid.Row="2" ColumnDefinitions="Auto,*,Auto,10,Auto">
            <Button Grid.Column="0" x:Name="ClearButton" Content="Clear All" Width="80" Height="28"
                    Click="ClearButton_Click"/>
            <Button Grid.Column="2" x:Name="OkButton" Content="OK" Width="80" Height="28"
                    Click="OkButton_Click"/>
            <Button Grid.Column="4" Content="Cancel" Width="80" Height="28"
                    Click="CancelButton_Click"/>
        </Grid>
    </Grid>
</Window>
